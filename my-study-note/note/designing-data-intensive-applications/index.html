<!DOCTYPE html>
<html lang="en-us"><head><meta charset="utf-8">
<meta http-equiv="content-type" content="text/html">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title itemprop="name"> | Awesome Hugo blog</title>
<meta property="og:title" content=" | Awesome Hugo blog" />
<meta name="twitter:title" content=" | Awesome Hugo blog" />
<meta itemprop="name" content=" | Awesome Hugo blog" />
<meta name="application-name" content=" | Awesome Hugo blog" />
<meta property="og:site_name" content="Awesome hugo blog" />

<meta name="description" content="Minimal Hugo blog theme with light and dark mode support">
<meta itemprop="description" content="Minimal Hugo blog theme with light and dark mode support" />
<meta property="og:description" content="Minimal Hugo blog theme with light and dark mode support" />
<meta name="twitter:description" content="Minimal Hugo blog theme with light and dark mode support" />

<meta property="og:locale" content="en-us" />
<meta name="language" content="en-us" />



  <meta itemprop="image" content="https://hba.sid.one/" />
  <meta property="og:image" content="https://hba.sid.one/" />
  <meta name="twitter:image" content="https://hba.sid.one/" />
  <meta name="twitter:image:src" content="https://hba.sid.one/" />





<meta name="generator" content="Hugo 0.117.0">

    

    <link rel="canonical" href="https://hba.sid.one/my-study-note/note/designing-data-intensive-applications/">
    <link href="/style.min.840eada6dfddec7b8ccfcf867f039bf80b1f16a265ec6e01dc553a3dddc9d509.css" rel="stylesheet">
    <link href="/code-highlight.min.706d31975fec544a864cb7f0d847a73ea55ca1df91bf495fd12a177138d807cf.css" rel="stylesheet">

    
    <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
    <link rel="mask-icon" href="/icons/safari-pinned-tab.svg">
    <link rel="shortcut icon" href="/favicon.ico">




<link rel="manifest" href="https://hba.sid.one/site.webmanifest">

<meta name="msapplication-config" content="/browserconfig.xml">
<meta name="msapplication-TileColor" content="#2d89ef">
<meta name="theme-color" content="#434648">

    
    <link rel="icon" type="image/svg+xml" href="/icons/favicon.svg">

    
    </head>
<body data-theme = "dark" class="notransition">

<script src="/js/theme.min.8961c317c5b88b953fe27525839672c9343f1058ab044696ca225656c8ba2ab0.js" integrity="sha256-iWHDF8W4i5U/4nUlg5ZyyTQ/EFirBEaWyiJWVsi6KrA="></script>

<div class="navbar" role="navigation">
    <nav class="menu" aria-label="Main Navigation">
        <a href="https://hba.sid.one/" class="logo">
            <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" 
viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" 
stroke-linejoin="round" class="feather feather-home">
<title>Home</title>
<path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
<polyline points="9 22 9 12 15 12 15 22"></polyline>
</svg>
        </a>
        <input type="checkbox" id="menu-trigger" class="menu-trigger" />
        <label for="menu-trigger">
            <span class="menu-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" stroke="currentColor" fill="none" viewBox="0 0 14 14"><title>Menu</title><path stroke-linecap="round" stroke-linejoin="round" d="M10.595 7L3.40726 7"></path><path stroke-linecap="round" stroke-linejoin="round" d="M10.5096 3.51488L3.49301 3.51488"></path><path stroke-linecap="round" stroke-linejoin="round" d="M10.5096 10.4851H3.49301"></path><path stroke-linecap="round" stroke-linejoin="round" d="M0.5 12.5V1.5C0.5 0.947715 0.947715 0.5 1.5 0.5H12.5C13.0523 0.5 13.5 0.947715 13.5 1.5V12.5C13.5 13.0523 13.0523 13.5 12.5 13.5H1.5C0.947715 13.5 0.5 13.0523 0.5 12.5Z"></path></svg>
            </span>
        </label>

        <div class="trigger">
            <ul class="trigger-container">
                
                
                <li>
                    <a class="menu-link " href="/">
                        Home
                    </a>
                    
                </li>
                
                <li>
                    <a class="menu-link " href="/posts/">
                        Posts
                    </a>
                    
                </li>
                
                <li>
                    <a class="menu-link " href="/about/">
                        About
                    </a>
                    
                </li>
                
                <li class="menu-separator">
                    <span>|</span>
                </li>
            </ul>
            <a id="mode" href="#">
                <svg xmlns="http://www.w3.org/2000/svg" class="mode-sunny" width="21" height="21" viewBox="0 0 14 14" stroke-width="1">
<title>LIGHT</title><g><circle cx="7" cy="7" r="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round"></circle><line x1="7" y1="0.5" x2="7" y2="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="2.4" y1="2.4" x2="3.82" y2="3.82" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="0.5" y1="7" x2="2.5" y2="7" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="2.4" y1="11.6" x2="3.82" y2="10.18" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="7" y1="13.5" x2="7" y2="11.5" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="11.6" y1="11.6" x2="10.18" y2="10.18" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="13.5" y1="7" x2="11.5" y2="7" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="11.6" y1="2.4" x2="10.18" y2="3.82" fill="none" stroke-linecap="round" stroke-linejoin="round"></line></g></svg>
                <svg xmlns="http://www.w3.org/2000/svg" class="mode-moon" width="21" height="21" viewBox="0 0 14 14" stroke-width="1">
<title>DARK</title><g><circle cx="7" cy="7" r="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round"></circle><line x1="7" y1="0.5" x2="7" y2="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="2.4" y1="2.4" x2="3.82" y2="3.82" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="0.5" y1="7" x2="2.5" y2="7" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="2.4" y1="11.6" x2="3.82" y2="10.18" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="7" y1="13.5" x2="7" y2="11.5" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="11.6" y1="11.6" x2="10.18" y2="10.18" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="13.5" y1="7" x2="11.5" y2="7" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="11.6" y1="2.4" x2="10.18" y2="3.82" fill="none" stroke-linecap="round" stroke-linejoin="round"></line></g></svg>
            </a>
        </div>
    </nav>
</div>

<div class="wrapper post">
    <main class="page-content" aria-label="Content">
        <article>
            <header class="header">
                <h1 class="header-title"></h1>
                
            </header>
            <details class="toc">
                <summary><b>Table of Contents</b></summary>
                <nav id="TableOfContents">
  <ul>
    <li><a href="#第一章-可靠性可擴展性可維護性">第一章 可靠性、可擴展性、可維護性</a>
      <ul>
        <li><a href="#可靠性">可靠性</a></li>
        <li><a href="#可擴展性">可擴展性</a></li>
        <li><a href="#應對負載">應對負載</a></li>
        <li><a href="#可維護性">可維護性</a></li>
        <li><a href="#小節">小節</a></li>
      </ul>
    </li>
    <li><a href="#第二章-資料模型與查詢語言">第二章 資料模型與查詢語言</a>
      <ul>
        <li><a href="#關聯模型與文件模型">關聯模型與文件模型</a></li>
        <li><a href="#宣告式與命令式">宣告式與命令式</a></li>
        <li><a href="#graph-like-資料模型">Graph-Like 資料模型</a></li>
        <li><a href="#小結">小結</a></li>
      </ul>
    </li>
    <li><a href="#第三章-資料儲存與檢索">第三章 資料儲存與檢索</a></li>
    <li><a href="#第八章-交易">第八章 交易</a>
      <ul>
        <li><a href="#acid">ACID</a></li>
      </ul>
    </li>
  </ul>
</nav>
            </details><div class="page-content">
                <h1 id="資料密集系統設計-designing-data-intensive-applications">資料密集系統設計 Designing Data-Intensive Applications</h1>
<blockquote>
<p>筆記作者：WeiTheShinobi</p>
</blockquote>
<h2 id="第一章-可靠性可擴展性可維護性">第一章 可靠性、可擴展性、可維護性</h2>
<p>現在大部分的應用程式都是資料密集而非計算密集，資料才是問題，還好人類已經研究很多很好的抽象解決這些問題。本章會先走一次基礎知識，接下來的章節層層推進。現在的應用系統由多個組件和資料系統組合而成。</p>
<h3 id="可靠性">可靠性</h3>
<blockquote>
<p>即時發生了故障，系統依舊能正常工作。</p>
</blockquote>
<p>故障是不可能完全消除的，故意產生故障來檢驗系統是很好的，因為許多 bug 是由於不當的錯誤處理。硬體、軟體、人為都有可能出錯，軟體的故障出於對執行的系統有某些假設，而人為故障是最常發生的，例如環境配置錯誤，想要降低人為失誤：</p>
<ul>
<li>設計系統時就減少出錯機會</li>
<li>完整的測試：整合、單元、手動測試</li>
<li>測試環境</li>
<li>好的監控系統：好的 log，記錄出錯</li>
<li>能輕鬆地回滾</li>
</ul>
<p>並不是只有核電廠的系統需要可靠性，想想一個老奶奶把所有的照片都存在你的系統中，如果系統出錯他們的感受如何。</p>
<h3 id="可擴展性">可擴展性</h3>
<blockquote>
<p>描述系統對於負載增加的能力</p>
</blockquote>
<p>以 Twitter 為例，分為兩個功能，讀取和寫入文章，而這兩種功能分別有不同量級，一個被三千萬人追蹤的明星發布文章跟一般人的量級又不一樣。</p>
<p>我們通常關心吞吐量與回應時間，而回應時間也不該只是一個平均數字，而是要看他的分布狀況，通常會因為 IO 問題有一些異常值。人們常常以平均時間來當作指標，但這不太好。<strong>首先將數值做排序，然後選擇百分位數</strong>，例如 p50(中位數), p95 或 p99 都不錯，假如中位數延遲是200ms，代表有一半的人不超過，而高百分位通常代表高價值客戶，要確保這些人開心。根據 Amazon 的資料：回應每增加 100ms，銷售減少 1%；延遲 1 秒使客戶滿意度下降 16％。當然優化 p99 並不容易，因為這通常是因為發生不可控事件。</p>
<p>一個請求可能涉及多個後端服務，而最慢的服務會拖慢整體進度，每分鐘監控並作圖計算百分位數，降低取樣精度或是結合多台機器並沒有意義。</p>
<h3 id="應對負載">應對負載</h3>
<p>可以大致區分為水平擴展和垂直擴展，無狀態的服務水平擴展容易，有狀態的資料系統水平擴展會增加系統複雜度。大規模的系統需要高度訂製，沒有銀彈，例如每秒十萬次請求和每秒三次但每次 2GB 的系統非常不同，快速迭代通常比為假想做準備好。</p>
<h3 id="可維護性">可維護性</h3>
<p>軟體開發大部分的成本在於維護遺留系統，特別注意三個原則：</p>
<ul>
<li>可維運性</li>
</ul>
<p>有人說好的維運可以帶起壞的軟體，但壞的維運帶不動好的軟體。</p>
<ul>
<li>簡單性</li>
</ul>
<p>緊密耦合、依賴關係混亂、奇怪的特例，複雜讓維護變得超困難，容易出現 bug 而且超累人，消除複雜性最佳工具就是<strong>抽象</strong>，就像程式語言是機器碼、系統呼叫的抽象，SQL 是磁碟和記憶體資料結構的抽象，但道理人人都懂，做出好的抽象不容易。書中後面會提到。</p>
<ul>
<li>可演化性</li>
</ul>
<p>需求總是不斷變化，本書會探討大的資料系統中，提高敏捷性的做法，例如前面提到的 Twitter。</p>
<h3 id="小節">小節</h3>
<p>一個系統要滿足多種需求，包括<strong>功能性需求</strong>（要做什麼事）與非功能性需求（可靠、可擴展），可靠性意味著系統故障依然可運作，可擴展性是指系統應對負載增加，可維護性要好的運維和好的抽象。</p>
<h2 id="第二章-資料模型與查詢語言">第二章 資料模型與查詢語言</h2>
<p>本章探討關聯式資料庫、文件資料庫和圖像資料庫</p>
<h3 id="關聯模型與文件模型">關聯模型與文件模型</h3>
<p>模型百家爭鳴，關聯模型最終主導了持續三十年，而為了彈性與表達力，NoSQL出現了。SQL 在應用層與資料層中會有笨拙的轉換層。</p>
<p>關聯模型做的就是把資料攤開，靠查詢優化器搜尋，一個通用的優化器比手寫每個最佳做法好得多，關聯模型有簡潔的 join，多對一和多對多關係。</p>
<p>文件模型可以產生方便的一對多樹，但不太好多對一、多對多，如果想 join 就要處理應用程式碼，但是只要用在適合的場景就好了，像是紀錄 log，文件模型有較好的靈活性在遷移上（migration）。（schema-on-read）</p>
<p>現在很多 RMDBS 都支援 JSON 和 XML，兩者之前越來越近，一個列內不一定要是基本型別，可以是嵌套關係。</p>
<h3 id="宣告式與命令式">宣告式與命令式</h3>
<p>宣告式抽象的告知要求，不知道查詢的細節，命令式告訴程式要怎麼找到資料，也有一種混合式的 MapReduce，基本上有函數式的味道。</p>
<h3 id="graph-like-資料模型">Graph-Like 資料模型</h3>
<p>表如其名，就像是一個圖型一樣，由頂點和邊組合而成，關聯模型可以處理簡單的多對多，但是需求越來越複雜的話，使用圖像模型會更自然，圖像模型可以表現不同質的資料，一個人可以和喜歡什麼、文章、活動連結在一起。</p>
<p>每個<strong>點</strong>會有向外、向內和資料，每個<strong>邊</strong>會有開始、結束、標籤和屬性》</p>
<p>怎麼搜尋呢？假如要找從美國移民到歐洲的人，只要找出生標籤的邊連美國點、生活標籤的邊連歐洲點，然後回傳這些點的屬性即可。</p>
<h3 id="小結">小結</h3>
<p>雖然這三種模型至今被廣泛使用，但特定領域還是需要特別實作：</p>
<ul>
<li>基因：類似但不同的超長字串</li>
<li>粒子物理：超大量計算</li>
<li>全文檢索</li>
</ul>
<h2 id="第三章-資料儲存與檢索">第三章 資料儲存與檢索</h2>
<p>最簡單的資料庫可以像是 log 檔案一樣，從最尾端不斷新增，查詢就是全部掃描一次，但這樣在巨大的資料量下會很沒效率，所以有了索引，一種額外的結構，讓查詢可以更快，但索引又會拖慢寫入的速度。</p>
<h2 id="第八章-交易">第八章 交易</h2>
<p>交易是一種不錯的解決方案，我們會詳細來了解。</p>
<h3 id="acid">ACID</h3>
<p>Atomicity 不可分割性：這一套動作會全部成功或全部失敗，不可分割</p>
<p>Consistency 一致性：書中認為是一種行銷，因為這應該是應用程式端要負責的，資料庫沒辦法幫你決定哪些資料要「一致」</p>
<p>Isolation 隔離性：不同的操作在並行時應該互不影響，隔離性也有分等級，在後面會詳細提到。</p>
<p>Duranility 持久性：資料會永遠保存</p>

            </div>
        </article></main>
</div>
<footer class="footer">
    <span class="footer_item"> </span>
    &nbsp;

    <div class="footer_social-icons">
<a href="https://github.com/hugo-sid" target="_blank" rel="noopener noreferrer me"
    title="Github">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
    stroke-linecap="round" stroke-linejoin="round">
    <path
        d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22">
    </path>
</svg>
</a>
<a href="https://twitter.com" target="_blank" rel="noopener noreferrer me"
    title="Twitter">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
    stroke-linecap="round" stroke-linejoin="round">
    <path
        d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z">
    </path>
</svg>
</a>
<a href="index.xml" target="_blank" rel="noopener noreferrer me"
    title="Rss">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
    stroke-linecap="round" stroke-linejoin="round">
    <path d="M4 11a9 9 0 0 1 9 9" />
    <path d="M4 4a16 16 0 0 1 16 16" />
    <circle cx="5" cy="19" r="1" />
</svg>
</a>
</div>
    <small class="footer_copyright">
        © 2023 Sidharth R.
        Powered by <a href="https://github.com/hugo-sid/hugo-blog-awesome" target="_blank" rel="noreferrer noopener">Hugo blog awesome</a>
        theme on
        <a href="https://gohugo.io" target="_blank" rel="noreferrer noopener">Hugo</a>.
    </small>
</footer><a href="#" title="Go to top" id="totop">
    <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" fill="currentColor" stroke="currentColor" viewBox="0 96 960 960">
    <path d="M283 704.739 234.261 656 480 410.261 725.739 656 677 704.739l-197-197-197 197Z"/>
</svg>

</a>


    




    
    
        
    

    
    
        
    



    
    <script src="https://hba.sid.one/js/main.min.35f435a5d8eac613c52daa28d8af544a4512337d3e95236e4a4978417b8dcb2f.js" integrity="sha256-NfQ1pdjqxhPFLaoo2K9USkUSM30&#43;lSNuSkl4QXuNyy8="></script>

    

</body>
</html>
